(function () {
var save = (function () {
  'use strict';

  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

  var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');

  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');

  var enableWhenDirty = function (editor) {
    return editor.getParam('save_enablewhendirty', true);
  };
  var hasOnSaveCallback = function (editor) {
    return !!editor.getParam('save_onsavecallback');
  };
  var hasOnCancelCallback = function (editor) {
    return !!editor.getParam('save_oncancelcallback');
  };
  var $_5pp520j6jgqkx0mm = {
    enableWhenDirty: enableWhenDirty,
    hasOnSaveCallback: hasOnSaveCallback,
    hasOnCancelCallback: hasOnCancelCallback
  };

  var displayErrorMessage = function (editor, message) {
    editor.notificationManager.open({
      text: editor.translate(message),
      type: 'error'
    });
  };
  var save = function (editor) {
    var formObj;
    formObj = global$1.DOM.getParent(editor.id, 'form');
    editor.save();
    if ($_5pp520j6jgqkx0mm.hasOnSaveCallback(editor)) {
      editor.execCallback('save_onsavecallback', editor);
      editor.nodeChanged();
      return;
    }
    if (formObj) {
      editor.setDirty(false);
      if (!formObj.onsubmit || formObj.onsubmit()) {
        if (typeof formObj.submit === 'function') {
            if (!document.getElementById("content").value || !document.getElementById("title").textContent) {
                displayErrorMessage(editor, 'Error: Title or editor empty.');
            } else {
                formObj.submit();
            }
        } else {
          displayErrorMessage(editor, 'Error: Form submit field collision.');
        }
      }
      editor.nodeChanged();
    } else {
      displayErrorMessage(editor, 'Error: No form element found.');
    }
  };
  var publish = function (editor) {
    var formObj;
    formObj = global$1.DOM.getParent(editor.id, 'form');
    editor.save();
    if (formObj) {
      editor.setDirty(false);
      if (!formObj.onsubmit || formObj.onsubmit()) {
        if (typeof formObj.submit === 'function') {
            if (!document.getElementById("content").value || !document.getElementById("title").textContent) {
                displayErrorMessage(editor, 'Error: Title or editor empty.');
            } else {
                document.getElementById("published").setAttribute('value', '1');
                formObj.submit();
            }
        } else {
          displayErrorMessage(editor, 'Error: Form submit field collision.');
        }
      }
      editor.nodeChanged();
    } else {
      displayErrorMessage(editor, 'Error: No form element found.');
    }
  };
  var unpublish = function (editor) {
    var formObj;
    formObj = global$1.DOM.getParent(editor.id, 'form');
    editor.save();
    if (formObj) {
      editor.setDirty(false);
      if (!formObj.onsubmit || formObj.onsubmit()) {
        if (typeof formObj.submit === 'function') {
            if (!document.getElementById("content").value || !document.getElementById("title").textContent) {
                displayErrorMessage(editor, 'Error: Title or editor empty.');
            } else {
                document.getElementById("published").setAttribute('value', '0');
                formObj.submit();
            }
        } else {
          displayErrorMessage(editor, 'Error: Form submit field collision.');
        }
      }
      editor.nodeChanged();
    } else {
      displayErrorMessage(editor, 'Error: No form element found.');
    }
  };
  var remove = function (editor) {
    var formObj;
    formObj = global$1.DOM.getParent(editor.id, 'form');
    editor.save();
    if (formObj) {
      editor.setDirty(false);
      if (!formObj.onsubmit || formObj.onsubmit()) {
        if (typeof formObj.submit === 'function') {
            if (window.confirm(editor.translate('Are you sur you want to delete ? You will not be able to go back !'))) {
                document.getElementById('editForm').setAttribute('action', document.getElementById('editForm').getAttribute('action').replace(/Enregister/, 'Supprimer'));
                formObj.submit();
                }
        } else {
          displayErrorMessage(editor, 'Error: Form submit field collision.');
        }
      }
      editor.nodeChanged();
    } else {
      displayErrorMessage(editor, 'Error: No form element found.');
    }
  };
  var cancel = function (editor) {
    var h = global$2.trim(editor.startContent);
    if ($_5pp520j6jgqkx0mm.hasOnCancelCallback(editor)) {
      editor.execCallback('save_oncancelcallback', editor);
      return;
    }
    editor.setContent(h);
    editor.undoManager.clear();
    editor.nodeChanged();
  };
  var $_9tjlnlj3jgqkx0mj = {
    save: save,
    publish: publish,
    unpublish: unpublish,
    remove: remove,
    cancel: cancel
  };

  var register = function (editor) {
    editor.addCommand('mceSave', function () {
      $_9tjlnlj3jgqkx0mj.save(editor);
    });
    editor.addCommand('mcePublish', function () {
      $_9tjlnlj3jgqkx0mj.publish(editor);
    });
    editor.addCommand('mceUnpublish', function () {
      $_9tjlnlj3jgqkx0mj.unpublish(editor);
    });
    editor.addCommand('mceRemove', function () {
      $_9tjlnlj3jgqkx0mj.remove(editor);
    });
    editor.addCommand('mceCancel', function () {
      $_9tjlnlj3jgqkx0mj.cancel(editor);
    });
  };
  var $_e0lgzsj2jgqkx0mi = { register: register };

  var stateToggle = function (editor) {
    return function (e) {
      var ctrl = e.control;
      editor.on('nodeChange dirty', function () {
        ctrl.disabled($_5pp520j6jgqkx0mm.enableWhenDirty(editor) && !editor.isDirty());
      });
    };
  };
  var register$1 = function (editor) {
    editor.addButton('save', {
      icon: 'save',
      text: 'Save',
      cmd: 'mceSave',
    });
    editor.addButton('publish', {
      icon: 'template',
      text: 'Publish',
      cmd: 'mcePublish',
    });
    editor.addButton('unpublish', {
      icon: 'template',
      text: 'Unpublish',
      cmd: 'mceUnpublish',
    });
    editor.addButton('remove', {
      icon: 'remove2',
      text: 'Remove',
      cmd: 'mceRemove'
    });
    editor.addButton('cancel', {
      text: 'Cancel',
      icon: '',
      cmd: 'mceCancel',
      disabled: true,
      onPostRender: stateToggle(editor)
    });
    editor.addShortcut('Meta+S', '', 'mceSave');
  };
  var $_6pkvo1j7jgqkx0mn = { register: register$1 };

  global.add('save', function (editor) {
    $_6pkvo1j7jgqkx0mn.register(editor);
    $_e0lgzsj2jgqkx0mi.register(editor);
  });
  function Plugin () {
  }

  return Plugin;

}());
})();
